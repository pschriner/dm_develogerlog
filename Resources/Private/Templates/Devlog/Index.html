{namespace core = TYPO3\CMS\Core\ViewHelpers}
{namespace devlog=DieMedialen\DmDeveloperlog\ViewHelpers}
<f:layout name="Backend/Default" />

<f:section name="headline">
	Developer log
</f:section>

<f:section name="content">
	<style>
		.zeroPadding {
			padding: 0 !important;
		}
		tr[data-toggle~=collapse]:hover {
			cursor: pointer;
		}
		ul.f3-widget-paginator {
			margin:0;padding:0;
		}
		ul.f3-widget-paginator li {
			list-style:none;
			display:inline-block;
			border: 1px solid #bbbbbb;
			padding:0.5em;
			border-radius: 2px;
		}
		ul.f3-widget-paginator li.current {
			background-color:#eeeeee;
		}
		tr.collapse.in {
			display: table-row;
		}
	</style>

	<f:flashMessages />
	
	<div class="pull-right">
		<a href="{f:uri.action(action:'flush')}" class="btn btn-warning t3js-modal-trigger" data-severity="warning" data-title="{f:translate(key:'flush.modal.title')}" data-severity"danger"><core:icon identifier="actions-delete" />{f:translate(key:'flush.action.title')}</a>
	</div>
	<div>
	<f:form action="index" object="{constraint}" name="constraint" class="form-inline">
		<div class="form-group">
			<label for="search"><f:translate key="search.for" /></label> <f:form.textfield property="search" class="form-control input-sm" placeholder="message" />
		</div>
		<div class="form-group">
			<f:form.select property="severity" options="{severity-options}" class="form-control input-sm" />
		</div>
		<div class="form-group">
			<f:form.select property="extkey" options="{extkey-options}" class="form-control input-sm" prependOptionLabel="{f:translate(key:'form.options.extkey.all')}" prependOptionValue="" />
		</div>
		<f:form.submit class="btn btn-default btn-sm" value="{f:translate(key:'form.submit.search')}" /> 
	</f:form>
	</div>
	<p class="clearfix">&nbsp;</p>
	
	<f:if condition="{logEntries->f:count()}">
	<f:then>
	<f:widget.paginate objects="{logEntries}" as="paginatedLogEntries" configuration="{itemsPerPage:20,addQueryStringMethod:'POST,GET'}">
	<div class="table-fit">
		<table id="dm-developerlog-list" class="table table-responsive table-hover">
		<thead>
			<tr>
				<th></th>
				<th><f:translate key="module.list.crdate" /></th>
				<th><f:translate key="module.list.request_id" /></th>
				<th><f:translate key="module.list.key" /></th>
				<th class="hidden-sm hidden-xs"><f:translate key="module.list.location" />:<f:translate key="module.list.line" /></th>
				<th><f:translate key="module.list.message" /></th>
				<th class="hidden-md hidden-lg"></th>
			</tr>
		</thead>
		<tbody>
			<f:for each="{paginatedLogEntries}" as="logEntry">
			<tr class="{logEntry.severity -> devlog:mapToHelperClass()}" data-toggle="collapse" data-target="#collapsed-{logEntry.uid}" title="Click to expand">
				<td><f:render partial="SeverityIcon" arguments="{_all}" /></td>
				<td><f:format.date format="%x %X">{logEntry.crdate}</f:format.date></td>
				<td>{logEntry.requestId}</td>
				<td>{logEntry.extkey}</td>
				<td class="hidden-sm hidden-xs">{logEntry.location}:{logEntry.line}</td>
				<td style="white-space:normal">{logEntry.message}</td>
				<th class="hidden-md hidden-lg"></th>
			</tr>
			<tr class="{logEntry.severity -> devlog:mapToHelperClass()}">
				<td class="zeroPadding" colspan="7"><div class="collapse" id="collapsed-{logEntry.uid}">
					<div class="container-fluid">
						<div class="row hidden-md hidden-lg">
							<div class="col-sm-12 col-xs-12">
								<f:translate key="module.list.location" />:<f:translate key="module.list.line" /> {logEntry.location}:{logEntry.line}
							</div>
						</div>
						<div class="row">
							<div class="col-sm-3 col-md-2">
								<f:translate key="module.list.requestType" />:
								<f:for each="{devlog:bitMask(value:logEntry.requestType)}" as="requestType">
									<f:translate key="module.list.requestType.{requestType}" />
								</f:for>
							</div>
							<f:if condition="{logEntry.beUser}">
							<div class="col-sm-3 col-md-2">
								<f:translate key="module.list.beUser" />: {logEntry.beUser}
							</div>
							</f:if>
							<f:if condition="{logEntry.feUser}">
							<div class="col-sm-3 col-md-2">
								<f:translate key="module.list.feUser" />: {logEntry.feUser}
							</div>
							</f:if>
							<div class="col-sm-3 col-md-6">&nbsp;</div>
						</div>
						<f:if condition="{logEntry.dataVar}">
						<div class="row">
							<div class="col-sm12 col-md-12">
								<f:translate key="module.list.data" />: {logEntry.dataVar}
							</div>
						</div>
						</f:if>
					</div>
				</div></td>
			</tr>
			</f:for>
		</tbody>
		</table>
	</div>
	</f:widget.paginate>
	</f:then>
	</f:if>
	
	<f:render partial="Notifications" />
</f:section>