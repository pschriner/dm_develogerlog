{namespace devlog=DieMedialen\DmDeveloperlog\ViewHelpers}
<f:layout name="Backend/Default62" />

<f:section name="headline">
	Developer log
</f:section>

<f:section name="content">
	<style>
		.zeroPadding {
			padding: 0 !important;
		}
		tr[data-toggle~=collapse]:hover {
			cursor: pointer;
		}
		ul.f3-widget-paginator {
			margin:0;padding:0;
		}
		ul.f3-widget-paginator li {
			list-style:none;
			display:inline-block;
			border: 1px solid #bbbbbb;
			padding:0.5em;
			border-radius: 2px;
		}
		ul.f3-widget-paginator li.current {
			background-color:#eeeeee;
		}
		.pull-right {
			float:right;
		}
	</style>

	<f:flashMessages />
	
	<div class="pull-right">
		<a href="{f:uri.action(action:'flush')}" class="t3-button">Delete all</a>
	</div>
	<div>
	<f:form action="index" object="{constraint}" name="constraint" class="form-inline">
			<label for="search"><f:translate key="search.for" /></label> <f:form.textfield property="search" class="form-control input-sm" placeholder="message" />
			<f:form.select property="severity" options="{severity-options}" class="form-control input-sm" />
			<f:form.select property="extkey" options="{extkey-options}" class="form-control input-sm" prependOptionLabel="All" prependOptionValue="" />
		<f:form.submit class="btn btn-default btn-sm" value="Search" /> 
	</f:form>
	</div>
	<p class="clearfix">&nbsp;</p>
	
	<f:if condition="{logEntries->f:count()}">
	<f:then>
	<f:widget.paginate objects="{logEntries}" as="paginatedLogEntries" configuration="{itemsPerPage:10,addQueryStringMethod:'POST,GET'}">
	<div class="table-fit">
		<table id="dm-developerlog-list" class="table table-hover t3-table">
		<thead>
			<tr class="t3-row-header">
				<th><f:translate key="module.list.crdate" /></th>
				<th><f:translate key="module.list.request_id" /></th>
				<th><f:translate key="module.list.key" /></th>
				<th><f:translate key="module.list.location" />:<f:translate key="module.list.line" /></th>
				<th><f:translate key="module.list.message" /></th>
			</tr>
		</thead>
		<tbody>
			<f:for each="{paginatedLogEntries}" as="logEntry">
			<tr class="{logEntry.severity -> devlog:mapToHelperClass()}">
				<td><f:format.date format="%x %X">{logEntry.crdate}</f:format.date></td>
				<td>{logEntry.requestId}</td>
				<td>{logEntry.extkey}</td>
				<td>{logEntry.location}:{logEntry.line}</td>
				<td style="white-space:normal">{logEntry.message}</td>
			</tr>
			<tr class="{logEntry.severity -> devlog:mapToHelperClass()}">
				<td>&nbsp;</td>
				<td colspan="4">
					<div class="container-fluid">
						<div class="row">
							<div class="col-sm-3 col-md-2">
								Request Type: {logEntry.requestType}
							</div>
							<div class="col-sm-3 col-md-2">
								Backend User: {logEntry.beUser}
							</div>
							<div class="col-sm-3 col-md-2">
								Frontend User: {logEntry.feUser}
							</div>
							<div class="col-sm-3 col-md-6">&nbsp;</div>
						</div>
						<div class="row">
							<div class="col-sm12 col-md-12">
								Data: {logEntry.dataVar}
							</div>
						</div>
					</div>
				</td>
			</tr>
			</f:for>
		</tbody>
		</table>
	</div>
	</f:widget.paginate>
	</f:then>
	</f:if>
</f:section>